# Bus Ticket Assistant — Offline RAG Streamlit App

This is a minimal **offline RAG** Streamlit app for a Bus Ticket Assistant.
It uses:
- `sentence-transformers/all-MiniLM-L6-v2` for embeddings (free)
- `google/flan-t5-small` for generation (free Hugging Face model)
- `faiss-cpu` for vector search
- `sqlite3` for storing bookings (self-hosted file)

## Project Overview

This project is an offline Retrieval-Augmented Generation (RAG) application designed to assist users with bus ticket inquiries. It allows users to interact with the system through a Streamlit interface to find information about bus services and potentially make bookings.

The application leverages RAG to provide contextually relevant answers by first retrieving relevant information from a knowledge base and then using a language model to generate a coherent response.

### Architecture Diagram

This diagram provides a more detailed breakdown of the application's processes and data flow:

```mermaid
graph TD
    A[User] --> B(Streamlit UI);

    subgraph Query Processing
        B --> C{User Query};
        C --> D[Clean & Normalize Query];
        D --> E[Generate Query Embedding];
    end

    subgraph Data & Models
        F[Provider Texts] --> G(Embedding Model);
        G --> H[Vector Index];
        I[Booking Data] --> J(App Logic);
        K[Other Data] --> J;
    end

    subgraph Retrieval & RAG
        E --> L(FAISS Vector Search);
        L --> M[Retrieve Relevant Document IDs];
        M --> N[Fetch Document Content];
        N --> O{Augment Prompt};
        O --> P[Generation Model];
        P --> Q[Generate Response];
    end

    J --> B; %% App Logic interacts with UI/data
    Q --> B; %% Response from Generation Model goes to UI
    B --> R[Final Output];

    %% Styling
    classDef ui fill:#cce5ff,stroke:#004085,stroke-width:2px;
    classDef process fill:#d4edda,stroke:#155724,stroke-width:2px;
    classDef data fill:#fff3cd,stroke:#856404,stroke-width:2px;
    classDef model fill:#e2e3e5,stroke:#383d41,stroke-width:2px;
    classDef index fill:#f8d7da,stroke:#721c24,stroke-width:2px;

    class B ui;
    class C,D,E,F,G,I,J,L,M,N,O,P,Q process;
    class A,F,I,K,R data;
    class G,P model;
    class H index; %% FAISS Vector Index
```

**Explanation of Components:**
- **User:** The end-user interacting with the application.
- **Streamlit UI (`app.py`):** The user interface built with Streamlit, handling user input and displaying output.
- **User Query:** The input text provided by the user for bus ticket assistance.
- **Clean & Normalize Query:** Preprocesses the user's query for better processing.
- **Generate Query Embedding:** Converts the cleaned user query into a numerical vector representation using an embedding model (`sentence-transformers`).
- **Provider Texts (`data/provider_texts/`):** Raw text data containing information about bus providers, used to build the embedding index.
- **Embedding Model (`sentence-transformers`):** The model responsible for converting text into numerical embeddings.
- **Vector Index (FAISS):** The FAISS index stores the embeddings of the provider texts for efficient similarity search.
- **Booking Data (`data/bookings.db`):** A SQLite database storing all booking-related information.
- **Other Data (`data/data.json`):** Additional data files that may be used by the application logic.
- **App Logic:** Orchestrates the entire process, managing data flow, interacting with the database, and coordinating the RAG pipeline.
- **FAISS Vector Search:** Performs a fast similarity search on the vector index to find documents semantically similar to the query embedding.
- **Retrieve Relevant Document IDs:** Identifies the IDs of the most relevant documents from the FAISS search.
- **Fetch Document Content:** Retrieves the actual text content of the documents corresponding to the identified IDs.
- **Augment Prompt:** Combines the retrieved document content with the original user query to create a richer prompt for the language model.
- **Generation Model (e.g., `flan-t5-small`):** A language model that takes the augmented prompt and generates a coherent, contextually relevant response.
- **Generate Response:** The final natural language response generated by the model.
- **Final Output:** The generated response presented to the user through the Streamlit UI.

## Quick Start Guide for New Users

To get started with the Bus Ticket Assistant, follow these steps:

1.  **Set up a Python Virtual Environment:**
    It's highly recommended to use a virtual environment to manage project dependencies and avoid conflicts with other Python projects.
    *   Create a virtual environment (e.g., using `venv`):
        ```bash
        python -m venv venv
        ```
    *   Activate the environment:
        *   On Windows: `.\venv\Scripts\activate`
        *   On macOS/Linux: `source venv/bin/activate`

2.  **Install Dependencies:**
    Once your virtual environment is active, install all the necessary Python packages listed in `requirements.txt`:
    ```bash
    pip install -r requirements.txt
    ```
    This command will download and install libraries like Streamlit, sentence-transformers, faiss-cpu, etc.

3.  **Prepare Data (Optional):**
    The application comes with sample data. If you have your own custom data, you can place your `data.json` file in the `data/` directory and any custom provider text files in the `data/provider_texts/` directory.

4.  **Run the Streamlit Application:**
    Start the Streamlit server to launch the application:
    ```bash
    streamlit run app.py
    ```
    This command will start the web server, and the application should become accessible in your default web browser.

5.  **Access the Application:**
    The application will typically be available at `http://localhost:8501`. Open this URL in your web browser to use the Bus Ticket Assistant.

## Files
- `app.py` — main Streamlit app
- `data/` — contains sample `data.json` and provider text files
- `data/faiss` — directory where FAISS index and meta will be created after first run
- `data/bookings.db` — SQLite bookings DB (created automatically)
- `requirements.txt` — Python dependencies

## Notes
- First run may download models (sentence-transformers and flan-t5-small) — this requires internet.
- After models are cached, the app runs offline.
- This is a demo scaffold; for production, consider stronger validation, auth, and more robust storage.
